<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Dauber">
<meta name="dcterms.date" content="2025-06-30">
<meta name="description" content="Learn how to create multi-dimensional tables in R using the GT package. This step-by-step tutorial covers the challenges of nested column headers, handling NA values in count data, and moving beyond tab_spanner_delim() for full customisation control. Perfect for R users wanting to create publication-ready tables with complex structures.">

<title>Social Science Sofa |  [___] - Taming Multi-Dimensional Tables with gt</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-T3MQH2G66G"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-T3MQH2G66G', { 'anonymize_ip': true});
</script>
<link rel="icon" type="image/png" href="../../favicon/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="../../favicon/favicon.svg">
<link rel="shortcut icon" href="../../favicon/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="../../favicon/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="manifest" href="../../favicon/site.webmanifest">
<!-- Open Graph / Facebook -->
<meta property="og:title" content="Social Science Sofa |  [___] - Taming Multi-Dimensional Tables with gt">
<meta property="og:description" content="Learn how to create multi-dimensional tables in R using the GT package. This step-by-step tutorial covers the challenges of nested column headers, handling NA values in count data, and moving beyond tab_spanner_delim() for full customisation control. Perfect for R users wanting to create publication-ready tables with complex structures.">
<meta property="og:image" content="https://thesocialsciencesofa.com/favicon/social_card.png">
<meta property="og:url" content="https://thesocialsciencesofa.com/">
<meta property="og:type" content="website">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Social Science Sofa |  [___] - Taming Multi-Dimensional Tables with gt">
<meta name="twitter:description" content="Learn how to create multi-dimensional tables in R using the GT package. This step-by-step tutorial covers the challenges of nested column headers, handling NA values in count data, and moving beyond tab_spanner_delim() for full customisation control. Perfect for R users wanting to create publication-ready tables with complex structures.">
<meta name="twitter:image" content="https://thesocialsciencesofa.com/favicon/social_card.png">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span class="site-name">Social Science Sofa | </span> <span class="logo-text">[___]</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://r4np.com" target="_blank"> 
<span class="menu-text">R4NP Book</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://danieldauber.com" target="_blank"> <i class="bi bi-person-circle" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ddauber" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/daniel_dauber" target="_blank"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/danieldauber.bsky.social" target="_blank"> <i class="bi bi-bluesky" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/danieldauber/" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Taming Multi-Dimensional Tables with <code>gt</code></h1>
                  <div>
        <div class="description">
          Learn how to create multi-dimensional tables in R using the GT package. This step-by-step tutorial covers the challenges of nested column headers, handling NA values in count data, and moving beyond <code>tab_spanner_delim()</code> for full customisation control. Perfect for R users wanting to create publication-ready tables with complex structures.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">data visualisation</div>
                <div class="quarto-category">gt</div>
                <div class="quarto-category">tables</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Dauber </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 30, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&amp;family=Fredoka:wght@300..700&amp;family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&amp;family=Quicksand:wght@300..700&amp;family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&amp;display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">





<div class="slide-in">
<p><img src="multi-dimensional-gt-tables-r.jpg" alt="A screenshot of a cleanly formatted multi-dimensional table created with the gt package." width="100%"></p>
</div>
<p>Creating beautiful tables in R has never been easier thanks to the <a href="https://gt.rstudio.com/"><code>gt</code> package</a>. But what happens when your “simple” table suddenly needs three dimensions? That’s when things get interesting – and by interesting, I mean frustratingly complex.</p>
<p>Today, we’ll walk through creating a multi-dimensional table that displays relationship status by gender across different countries. We’ll start simple and work our way up to the challenges that make you question your life choices (and then solve them, of course).</p>
<section id="meet-the-gt-package" class="level2">
<h2 class="anchored" data-anchor-id="meet-the-gt-package">Meet the GT Package</h2>
<p>The <a href="https://gt.rstudio.com/"><code>gt</code> package</a> by RStudio is a grammar of tables that makes creating publication-ready tables surprisingly enjoyable. Think of it as <code>ggplot2</code> for tables – it’s structured, flexible, and produces gorgeous output with relatively little code.</p>
<p>The package follows a layered approach: you start with your data, create a basic <code>gt()</code> object, then add layers of formatting, styling, and functionality. Each function adds a specific element to your table, making the code readable and the process intuitive.</p>
<p>If you’re new to R or finding this tutorial challenging to follow, I’d recommend checking out <a href="https://r4np.com">R for Non-Programmers</a> for a more gentle introduction to R fundamentals.</p>
</section>
<section id="our-data-world-values-survey" class="level2">
<h2 class="anchored" data-anchor-id="our-data-world-values-survey">Our Data: World Values Survey</h2>
<p>We’ll be working with data from the World Values Survey (WVS), which contains responses from people across different countries about their values and demographics. The <code>wvs_nona</code> dataset is a cleaned version where missing values have been removed (hence “nona” = no NAs).</p>
<p>If you want to follow along, you can get the dataset from the <a href="https://github.com/yourrepo/r4np"><code>r4np</code> package</a>:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install if you haven't already</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("r4np")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtExtras)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(r4np)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset we'll use</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wvs_nona)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  country gender   age relationship_status freedom_of_choice satisfaction
  &lt;fct&gt;   &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;                           &lt;dbl&gt;        &lt;dbl&gt;
1 Bolivia male      60 married                             7            5
2 Bolivia male      40 married                             8            7
3 Bolivia male      25 single                             10            8
4 Bolivia female    71 widowed                             5            5
5 Bolivia female    38 married                             5            7
6 Bolivia female    20 separated                           5            3</code></pre>
</div>
</div>
<p>Our goal is to create a table showing the relationship between three variables: <code>country</code>, <code>gender</code>, and <code>relationship_status</code>. This is what makes it “multi-dimensional” – we’re not just showing a simple two-way relationship, but a three-way interaction.</p>
</section>
<section id="step-1-the-innocent-beginning" class="level2">
<h2 class="anchored" data-anchor-id="step-1-the-innocent-beginning">Step 1: The Innocent Beginning</h2>
<p>Let’s start with what seems like a straightforward task: create a table showing the count of married, separated, and divorced people by gender across countries.</p>
<p>First, we need to count the combinations of our three variables:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create our base data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> wvs_nona <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender, country, relationship_status) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relationship_status <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"married"</span>, <span class="st">"separated"</span>, <span class="st">"divorced"</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a peek</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(table_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  gender country relationship_status     n
  &lt;fct&gt;  &lt;fct&gt;   &lt;fct&gt;               &lt;int&gt;
1 female Bolivia married               383
2 female Bolivia separated              62
3 female Bolivia divorced               27
4 female Iran    married               448
5 female Iran    separated               4
6 female Iran    divorced               24</code></pre>
</div>
</div>
<p>The <code>count()</code> function is doing the heavy lifting here. It groups by the three variables we specify and counts how many observations fall into each combination. The <code>filter()</code> step narrows our focus to just three relationship statuses – we’re keeping the analysis manageable.</p>
<p>This gives us a “long” format dataset where each row represents one combination of country, gender, and relationship status, with the count in the <code>n</code> column.</p>
<p>Now we need to reshape this data to make it suitable for a table. We want countries as rows and the gender-relationship combinations as columns:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for table format</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> table_data <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> country,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> <span class="fu">c</span>(gender, relationship_status),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wide_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  country female_married female_separated female_divorced male_married
  &lt;fct&gt;            &lt;int&gt;            &lt;int&gt;           &lt;int&gt;        &lt;int&gt;
1 Bolivia            383               62              27          376
2 Iran               448                4              24          518
3 Iraq               442                6              10          423
4 Japan              525                4              49          464
5 Korea              491                1               1          407
6 Egypt              399               10              23          434
# ℹ 2 more variables: male_separated &lt;int&gt;, male_divorced &lt;int&gt;</code></pre>
</div>
</div>
<p><code>pivot_wider()</code> is the magic function here. Let’s break down what each argument does:</p>
<ul>
<li><code>id_cols = country</code>: This tells R that <code>country</code> should remain as a column (our row identifier)</li>
<li><code>names_from = c(gender, relationship_status)</code>: These two variables will become column names</li>
<li><code>values_from = n</code>: The values that fill the table come from the <code>n</code> column (our counts)</li>
</ul>
<p>The result is columns with names like <code>female_married</code>, <code>male_divorced</code>, etc. R automatically combines the values from <code>gender</code> and <code>relationship_status</code> with an underscore.</p>
<p>Now let’s create our first GT table:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our first attempt</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>basic_table <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"World Value Survey (WVS)"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Relationship Status by Gender and Country"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>basic_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbqxewwjlu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tbqxewwjlu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tbqxewwjlu thead, #tbqxewwjlu tbody, #tbqxewwjlu tfoot, #tbqxewwjlu tr, #tbqxewwjlu td, #tbqxewwjlu th {
  border-style: none;
}

#tbqxewwjlu p {
  margin: 0;
  padding: 0;
}

#tbqxewwjlu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tbqxewwjlu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tbqxewwjlu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tbqxewwjlu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tbqxewwjlu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tbqxewwjlu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tbqxewwjlu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tbqxewwjlu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tbqxewwjlu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tbqxewwjlu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tbqxewwjlu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tbqxewwjlu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tbqxewwjlu .gt_spanner_row {
  border-bottom-style: hidden;
}

#tbqxewwjlu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tbqxewwjlu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tbqxewwjlu .gt_from_md > :first-child {
  margin-top: 0;
}

#tbqxewwjlu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tbqxewwjlu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tbqxewwjlu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tbqxewwjlu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tbqxewwjlu .gt_row_group_first td {
  border-top-width: 2px;
}

#tbqxewwjlu .gt_row_group_first th {
  border-top-width: 2px;
}

#tbqxewwjlu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tbqxewwjlu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tbqxewwjlu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tbqxewwjlu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tbqxewwjlu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tbqxewwjlu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tbqxewwjlu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tbqxewwjlu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tbqxewwjlu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tbqxewwjlu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tbqxewwjlu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tbqxewwjlu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tbqxewwjlu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tbqxewwjlu .gt_left {
  text-align: left;
}

#tbqxewwjlu .gt_center {
  text-align: center;
}

#tbqxewwjlu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tbqxewwjlu .gt_font_normal {
  font-weight: normal;
}

#tbqxewwjlu .gt_font_bold {
  font-weight: bold;
}

#tbqxewwjlu .gt_font_italic {
  font-style: italic;
}

#tbqxewwjlu .gt_super {
  font-size: 65%;
}

#tbqxewwjlu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tbqxewwjlu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tbqxewwjlu .gt_indent_1 {
  text-indent: 5px;
}

#tbqxewwjlu .gt_indent_2 {
  text-indent: 10px;
}

#tbqxewwjlu .gt_indent_3 {
  text-indent: 15px;
}

#tbqxewwjlu .gt_indent_4 {
  text-indent: 20px;
}

#tbqxewwjlu .gt_indent_5 {
  text-indent: 25px;
}

#tbqxewwjlu .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tbqxewwjlu div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="7" class="gt_heading gt_title gt_font_normal">World Value Survey (WVS)</th>
</tr>
<tr class="odd gt_heading">
<th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Relationship Status by Gender and Country</th>
</tr>
<tr class="header gt_col_headings">
<th id="country" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">country</th>
<th id="female_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">female_married</th>
<th id="female_separated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">female_separated</th>
<th id="female_divorced" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">female_divorced</th>
<th id="male_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">male_married</th>
<th id="male_separated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">male_separated</th>
<th id="male_divorced" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">male_divorced</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="country">Bolivia</td>
<td class="gt_row gt_right" headers="female_married">383</td>
<td class="gt_row gt_right" headers="female_separated">62</td>
<td class="gt_row gt_right" headers="female_divorced">27</td>
<td class="gt_row gt_right" headers="male_married">376</td>
<td class="gt_row gt_right" headers="male_separated">34</td>
<td class="gt_row gt_right" headers="male_divorced">24</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Iran</td>
<td class="gt_row gt_right" headers="female_married">448</td>
<td class="gt_row gt_right" headers="female_separated">4</td>
<td class="gt_row gt_right" headers="female_divorced">24</td>
<td class="gt_row gt_right" headers="male_married">518</td>
<td class="gt_row gt_right" headers="male_separated">8</td>
<td class="gt_row gt_right" headers="male_divorced">6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="country">Iraq</td>
<td class="gt_row gt_right" headers="female_married">442</td>
<td class="gt_row gt_right" headers="female_separated">6</td>
<td class="gt_row gt_right" headers="female_divorced">10</td>
<td class="gt_row gt_right" headers="male_married">423</td>
<td class="gt_row gt_right" headers="male_separated">5</td>
<td class="gt_row gt_right" headers="male_divorced">9</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Japan</td>
<td class="gt_row gt_right" headers="female_married">525</td>
<td class="gt_row gt_right" headers="female_separated">4</td>
<td class="gt_row gt_right" headers="female_divorced">49</td>
<td class="gt_row gt_right" headers="male_married">464</td>
<td class="gt_row gt_right" headers="male_separated">1</td>
<td class="gt_row gt_right" headers="male_divorced">20</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="country">Korea</td>
<td class="gt_row gt_right" headers="female_married">491</td>
<td class="gt_row gt_right" headers="female_separated">1</td>
<td class="gt_row gt_right" headers="female_divorced">1</td>
<td class="gt_row gt_right" headers="male_married">407</td>
<td class="gt_row gt_right" headers="male_separated">NA</td>
<td class="gt_row gt_right" headers="male_divorced">7</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Egypt</td>
<td class="gt_row gt_right" headers="female_married">399</td>
<td class="gt_row gt_right" headers="female_separated">10</td>
<td class="gt_row gt_right" headers="female_divorced">23</td>
<td class="gt_row gt_right" headers="male_married">434</td>
<td class="gt_row gt_right" headers="male_separated">7</td>
<td class="gt_row gt_right" headers="male_divorced">9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>gt()</code> function creates the basic table object, and <code>tab_header()</code> adds a title and subtitle. Simple enough, but not very pretty.</p>
</section>
<section id="step-2-the-plot-thickens" class="level2">
<h2 class="anchored" data-anchor-id="step-2-the-plot-thickens">Step 2: The Plot Thickens</h2>
<p>Our basic table works, but it’s not exactly reader-friendly. Those column names like <code>female_married</code> are functional but ugly. We want to group them under gender headers with clean sub-labels.</p>
<p>“No problem,” you think, “I’ll just use <code>tab_spanner_delim()</code>!”</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attempt with tab_spanner_delim()</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>spanners_attempt <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"World Value Survey (WVS)"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Relationship Status by Gender and Country"</span>  </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner_delim</span>(<span class="at">delim =</span> <span class="st">"_"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>spanners_attempt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="kcwsensuft" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kcwsensuft table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kcwsensuft thead, #kcwsensuft tbody, #kcwsensuft tfoot, #kcwsensuft tr, #kcwsensuft td, #kcwsensuft th {
  border-style: none;
}

#kcwsensuft p {
  margin: 0;
  padding: 0;
}

#kcwsensuft .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kcwsensuft .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kcwsensuft .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kcwsensuft .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kcwsensuft .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kcwsensuft .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kcwsensuft .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kcwsensuft .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kcwsensuft .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kcwsensuft .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kcwsensuft .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kcwsensuft .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kcwsensuft .gt_spanner_row {
  border-bottom-style: hidden;
}

#kcwsensuft .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kcwsensuft .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kcwsensuft .gt_from_md > :first-child {
  margin-top: 0;
}

#kcwsensuft .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kcwsensuft .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kcwsensuft .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kcwsensuft .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kcwsensuft .gt_row_group_first td {
  border-top-width: 2px;
}

#kcwsensuft .gt_row_group_first th {
  border-top-width: 2px;
}

#kcwsensuft .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kcwsensuft .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kcwsensuft .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kcwsensuft .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kcwsensuft .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kcwsensuft .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kcwsensuft .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kcwsensuft .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kcwsensuft .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kcwsensuft .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kcwsensuft .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kcwsensuft .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kcwsensuft .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kcwsensuft .gt_left {
  text-align: left;
}

#kcwsensuft .gt_center {
  text-align: center;
}

#kcwsensuft .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kcwsensuft .gt_font_normal {
  font-weight: normal;
}

#kcwsensuft .gt_font_bold {
  font-weight: bold;
}

#kcwsensuft .gt_font_italic {
  font-style: italic;
}

#kcwsensuft .gt_super {
  font-size: 65%;
}

#kcwsensuft .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kcwsensuft .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kcwsensuft .gt_indent_1 {
  text-indent: 5px;
}

#kcwsensuft .gt_indent_2 {
  text-indent: 10px;
}

#kcwsensuft .gt_indent_3 {
  text-indent: 15px;
}

#kcwsensuft .gt_indent_4 {
  text-indent: 20px;
}

#kcwsensuft .gt_indent_5 {
  text-indent: 25px;
}

#kcwsensuft .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kcwsensuft div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header gt_heading">
<th colspan="7" class="gt_heading gt_title gt_font_normal">World Value Survey (WVS)</th>
</tr>
<tr class="odd gt_heading">
<th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Relationship Status by Gender and Country</th>
</tr>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="country" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">country</th>
<th colspan="3" id="spanner-female_married" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
female
</div></th>
<th colspan="3" id="spanner-male_married" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
male
</div></th>
</tr>
<tr class="odd gt_col_headings">
<th id="female_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">married</th>
<th id="female_separated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">separated</th>
<th id="female_divorced" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">divorced</th>
<th id="male_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">married</th>
<th id="male_separated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">separated</th>
<th id="male_divorced" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">divorced</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="country">Bolivia</td>
<td class="gt_row gt_right" headers="female_married">383</td>
<td class="gt_row gt_right" headers="female_separated">62</td>
<td class="gt_row gt_right" headers="female_divorced">27</td>
<td class="gt_row gt_right" headers="male_married">376</td>
<td class="gt_row gt_right" headers="male_separated">34</td>
<td class="gt_row gt_right" headers="male_divorced">24</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Iran</td>
<td class="gt_row gt_right" headers="female_married">448</td>
<td class="gt_row gt_right" headers="female_separated">4</td>
<td class="gt_row gt_right" headers="female_divorced">24</td>
<td class="gt_row gt_right" headers="male_married">518</td>
<td class="gt_row gt_right" headers="male_separated">8</td>
<td class="gt_row gt_right" headers="male_divorced">6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="country">Iraq</td>
<td class="gt_row gt_right" headers="female_married">442</td>
<td class="gt_row gt_right" headers="female_separated">6</td>
<td class="gt_row gt_right" headers="female_divorced">10</td>
<td class="gt_row gt_right" headers="male_married">423</td>
<td class="gt_row gt_right" headers="male_separated">5</td>
<td class="gt_row gt_right" headers="male_divorced">9</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Japan</td>
<td class="gt_row gt_right" headers="female_married">525</td>
<td class="gt_row gt_right" headers="female_separated">4</td>
<td class="gt_row gt_right" headers="female_divorced">49</td>
<td class="gt_row gt_right" headers="male_married">464</td>
<td class="gt_row gt_right" headers="male_separated">1</td>
<td class="gt_row gt_right" headers="male_divorced">20</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="country">Korea</td>
<td class="gt_row gt_right" headers="female_married">491</td>
<td class="gt_row gt_right" headers="female_separated">1</td>
<td class="gt_row gt_right" headers="female_divorced">1</td>
<td class="gt_row gt_right" headers="male_married">407</td>
<td class="gt_row gt_right" headers="male_separated">NA</td>
<td class="gt_row gt_right" headers="male_divorced">7</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Egypt</td>
<td class="gt_row gt_right" headers="female_married">399</td>
<td class="gt_row gt_right" headers="female_separated">10</td>
<td class="gt_row gt_right" headers="female_divorced">23</td>
<td class="gt_row gt_right" headers="male_married">434</td>
<td class="gt_row gt_right" headers="male_separated">7</td>
<td class="gt_row gt_right" headers="male_divorced">9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>tab_spanner_delim()</code> is GT’s convenient function for automatically creating column groups. It looks at your column names, splits them at the delimiter you specify (in this case, the underscore), and creates grouped headers.</p>
<p>This creates the gender groupings automatically by splitting on the underscore. The part before the underscore becomes the group header (“female”, “male”), and the part after becomes the column label (“married”, “separated”, “divorced”).</p>
<p>It’s clean, it’s automatic, and it… doesn’t let you customise the subcategory labels. You’re stuck with “married”, “separated”, “divorced” exactly as they appear in your column names.</p>
<p>What if you want “Married” (capitalised), “Sep.” (abbreviated), or “Divorced/Separated” (combined)? What if you want to style them with bold or italic text? <code>tab_spanner_delim()</code> just shrugs and says “take it or leave it.”</p>
</section>
<section id="step-3-the-manual-labor-solution" class="level2">
<h2 class="anchored" data-anchor-id="step-3-the-manual-labor-solution">Step 3: The Manual Labor Solution</h2>
<p>This is where GT shows both its power and its complexity. To get full control, we need to manually create our spanners and relabel our columns. It’s more work, but it’s infinitely more flexible.</p>
<p>Let’s break this down step by step:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The manual approach - more control, more code</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>custom_table <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"World Value Survey (WVS)"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Data extract from r4np"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Create individual gender spanners</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"*female*"</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"female_"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"*male*"</span>), </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"male_"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2: Create an overarching gender spanner</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"**Gender**"</span>),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"female_"</span>, <span class="st">"male_"</span>)),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"gender"</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Customise individual column labels</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">country =</span> <span class="fu">md</span>(<span class="st">"**Country**"</span>),</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">"married"</span>) <span class="sc">~</span> <span class="st">"Married"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">"separated"</span>) <span class="sc">~</span> <span class="st">"Separated"</span>, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">"divorced"</span>) <span class="sc">~</span> <span class="st">"Divorced"</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>custom_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="mwkiyqhhud" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mwkiyqhhud table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mwkiyqhhud thead, #mwkiyqhhud tbody, #mwkiyqhhud tfoot, #mwkiyqhhud tr, #mwkiyqhhud td, #mwkiyqhhud th {
  border-style: none;
}

#mwkiyqhhud p {
  margin: 0;
  padding: 0;
}

#mwkiyqhhud .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mwkiyqhhud .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mwkiyqhhud .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mwkiyqhhud .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mwkiyqhhud .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwkiyqhhud .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwkiyqhhud .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwkiyqhhud .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mwkiyqhhud .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mwkiyqhhud .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mwkiyqhhud .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mwkiyqhhud .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mwkiyqhhud .gt_spanner_row {
  border-bottom-style: hidden;
}

#mwkiyqhhud .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mwkiyqhhud .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mwkiyqhhud .gt_from_md > :first-child {
  margin-top: 0;
}

#mwkiyqhhud .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mwkiyqhhud .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mwkiyqhhud .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mwkiyqhhud .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mwkiyqhhud .gt_row_group_first td {
  border-top-width: 2px;
}

#mwkiyqhhud .gt_row_group_first th {
  border-top-width: 2px;
}

#mwkiyqhhud .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwkiyqhhud .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mwkiyqhhud .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mwkiyqhhud .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwkiyqhhud .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwkiyqhhud .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mwkiyqhhud .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mwkiyqhhud .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mwkiyqhhud .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwkiyqhhud .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwkiyqhhud .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwkiyqhhud .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwkiyqhhud .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwkiyqhhud .gt_left {
  text-align: left;
}

#mwkiyqhhud .gt_center {
  text-align: center;
}

#mwkiyqhhud .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mwkiyqhhud .gt_font_normal {
  font-weight: normal;
}

#mwkiyqhhud .gt_font_bold {
  font-weight: bold;
}

#mwkiyqhhud .gt_font_italic {
  font-style: italic;
}

#mwkiyqhhud .gt_super {
  font-size: 65%;
}

#mwkiyqhhud .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mwkiyqhhud .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mwkiyqhhud .gt_indent_1 {
  text-indent: 5px;
}

#mwkiyqhhud .gt_indent_2 {
  text-indent: 10px;
}

#mwkiyqhhud .gt_indent_3 {
  text-indent: 15px;
}

#mwkiyqhhud .gt_indent_4 {
  text-indent: 20px;
}

#mwkiyqhhud .gt_indent_5 {
  text-indent: 25px;
}

#mwkiyqhhud .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mwkiyqhhud div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header gt_heading">
<th colspan="7" class="gt_heading gt_title gt_font_normal">World Value Survey (WVS)</th>
</tr>
<tr class="odd gt_heading">
<th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Data extract from r4np</th>
</tr>
<tr class="header gt_col_headings gt_spanner_row">
<th class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="col"></th>
<th colspan="6" id="gender" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
<strong>Gender</strong>
</div></th>
</tr>
<tr class="odd gt_col_headings gt_spanner_row">
<th rowspan="2" id="country" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Country</strong></th>
<th colspan="3" id="*female*" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
<em>female</em>
</div></th>
<th colspan="3" id="*male*" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
<em>male</em>
</div></th>
</tr>
<tr class="header gt_col_headings">
<th id="female_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Married</th>
<th id="female_separated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Separated</th>
<th id="female_divorced" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Divorced</th>
<th id="male_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Married</th>
<th id="male_separated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Separated</th>
<th id="male_divorced" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Divorced</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="country">Bolivia</td>
<td class="gt_row gt_right" headers="female_married">383</td>
<td class="gt_row gt_right" headers="female_separated">62</td>
<td class="gt_row gt_right" headers="female_divorced">27</td>
<td class="gt_row gt_right" headers="male_married">376</td>
<td class="gt_row gt_right" headers="male_separated">34</td>
<td class="gt_row gt_right" headers="male_divorced">24</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Iran</td>
<td class="gt_row gt_right" headers="female_married">448</td>
<td class="gt_row gt_right" headers="female_separated">4</td>
<td class="gt_row gt_right" headers="female_divorced">24</td>
<td class="gt_row gt_right" headers="male_married">518</td>
<td class="gt_row gt_right" headers="male_separated">8</td>
<td class="gt_row gt_right" headers="male_divorced">6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="country">Iraq</td>
<td class="gt_row gt_right" headers="female_married">442</td>
<td class="gt_row gt_right" headers="female_separated">6</td>
<td class="gt_row gt_right" headers="female_divorced">10</td>
<td class="gt_row gt_right" headers="male_married">423</td>
<td class="gt_row gt_right" headers="male_separated">5</td>
<td class="gt_row gt_right" headers="male_divorced">9</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Japan</td>
<td class="gt_row gt_right" headers="female_married">525</td>
<td class="gt_row gt_right" headers="female_separated">4</td>
<td class="gt_row gt_right" headers="female_divorced">49</td>
<td class="gt_row gt_right" headers="male_married">464</td>
<td class="gt_row gt_right" headers="male_separated">1</td>
<td class="gt_row gt_right" headers="male_divorced">20</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="country">Korea</td>
<td class="gt_row gt_right" headers="female_married">491</td>
<td class="gt_row gt_right" headers="female_separated">1</td>
<td class="gt_row gt_right" headers="female_divorced">1</td>
<td class="gt_row gt_right" headers="male_married">407</td>
<td class="gt_row gt_right" headers="male_separated">NA</td>
<td class="gt_row gt_right" headers="male_divorced">7</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="country">Egypt</td>
<td class="gt_row gt_right" headers="female_married">399</td>
<td class="gt_row gt_right" headers="female_separated">10</td>
<td class="gt_row gt_right" headers="female_divorced">23</td>
<td class="gt_row gt_right" headers="male_married">434</td>
<td class="gt_row gt_right" headers="male_separated">7</td>
<td class="gt_row gt_right" headers="male_divorced">9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s dissect what’s happening here:</p>
<p><strong>Step 1: Individual Gender Spanners</strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_spanner</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"*female*"</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"female_"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates a spanner (column group) labeled “female” that covers all columns starting with “female_”. The <code>md()</code> function allows us to use markdown formatting – in this case, italics with the asterisks.</p>
<p>The <code>starts_with()</code> function is a “tidy select” helper that selects columns based on their names. It’s much more reliable than typing out column names manually, especially when your column names follow a pattern.</p>
<p><strong>Step 2: Overarching Spanner</strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_spanner</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"**Gender**"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"female_"</span>, <span class="st">"male_"</span>)),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">"gender"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates a higher-level spanner that encompasses both gender groups. The <code>columns</code> argument uses a vector of prefixes to select all columns that start with either “female_” or “male_”. The <code>id = "gender"</code> gives this spanner a unique identifier that we could reference later if needed.</p>
<p><strong>Step 3: Column Label Customisation</strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cols_label</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">md</span>(<span class="st">"**Country**"</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ends_with</span>(<span class="st">"married"</span>) <span class="sc">~</span> <span class="st">"Married"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ends_with</span>(<span class="st">"separated"</span>) <span class="sc">~</span> <span class="st">"Separated"</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ends_with</span>(<span class="st">"divorced"</span>) <span class="sc">~</span> <span class="st">"Divorced"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s where the magic happens. <code>cols_label()</code> lets us rename columns, but it also supports conditional renaming using the <code>~</code> formula syntax.</p>
<ul>
<li><code>country = md("**Country**")</code>: Directly renames the country column</li>
<li><code>ends_with("married") ~ "Married"</code>: This says “for any column that ends with ‘married’, rename it to ‘Married’”</li>
</ul>
<p>This pattern-based renaming is incredibly powerful. Instead of writing:</p>
<div id="tbl-different-correlations" class="cell slide-in quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-different-correlations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1
</figcaption>
<div aria-describedby="tbl-different-correlations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code anchored" id="tbl-different-correlations"><pre class="sourceCode r cell slide-in code-with-copy"><code class="sourceCode r"><span id="tbl-different-correlations-1"><a href="#tbl-different-correlations-1" aria-hidden="true" tabindex="-1"></a>female_married <span class="ot">=</span> <span class="st">"Married"</span>,</span>
<span id="tbl-different-correlations-2"><a href="#tbl-different-correlations-2" aria-hidden="true" tabindex="-1"></a>male_married <span class="ot">=</span> <span class="st">"Married"</span>,</span>
<span id="tbl-different-correlations-3"><a href="#tbl-different-correlations-3" aria-hidden="true" tabindex="-1"></a>female_separated <span class="ot">=</span> <span class="st">"Separated"</span>,</span>
<span id="tbl-different-correlations-4"><a href="#tbl-different-correlations-4" aria-hidden="true" tabindex="-1"></a>male_separated <span class="ot">=</span> <span class="st">"Separated"</span></span>
<span id="tbl-different-correlations-5"><a href="#tbl-different-correlations-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ... and so on</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<p>We can use the formula syntax to apply the same transformation to multiple columns at once. The results is pretty respectable.</p>
</section>
<section id="step-4-the-na-problem-plot-twist" class="level2">
<h2 class="anchored" data-anchor-id="step-4-the-na-problem-plot-twist">Step 4: The NA Problem (Plot Twist!)</h2>
<p>But wait, there’s more! Let’s add a total column to show the sum across relationship statuses:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding totals - first attempt</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>with_totals <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="sc">-</span>country))) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... rest of our formatting code</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="at">total =</span> <span class="fu">md</span>(<span class="st">"**Total**"</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>with_totals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s break down that <code>mutate()</code> line: - <code>select(., -country)</code>: Selects all columns except <code>country</code> (the <code>.</code> refers to the current data frame) - <code>rowSums()</code>: Sums across columns for each row - <code>mutate(total = ...)</code>: Creates a new column called <code>total</code> with these row sums</p>
<p>You might notice some countries have suspiciously low totals or <code>NA</code> values. That’s because <code>rowSums()</code> doesn’t handle <code>NA</code> values the way you might expect – if any value in a row is <code>NA</code>, the entire sum becomes <code>NA</code>.</p>
<p>In our case, <code>NA</code> in the count data doesn’t mean “missing information” – it means “zero observations for this combination.” For example, if a country has no divorced males in the survey, that cell will be <code>NA</code>, but for our table purposes, we want to treat it as zero.</p>
</section>
<section id="step-5-the-na-solution" class="level2">
<h2 class="anchored" data-anchor-id="step-5-the-na-solution">Step 5: The NA Solution</h2>
<p>Let’s fix the NA problem properly:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The NA fix</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>clean_data <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA with 0 - this makes sense for count data</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now rowSums will work properly</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="sc">-</span>country)))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code introduces a powerful pattern:</p>
<p><strong><code>across()</code> for Multiple Column Operations</strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>across()</code> is a function that applies the same transformation to multiple columns. Let’s break it down:</p>
<ul>
<li><code>where(is.numeric)</code>: Selects columns based on a condition – in this case, all numeric columns</li>
<li><code>~ if_else(is.na(.), 0, .)</code>: This is a formula (notice the <code>~</code>) that defines the transformation
<ul>
<li><code>is.na(.)</code>: Checks if the value is NA (the <code>.</code> represents each value)</li>
<li><code>if_else(condition, true_value, false_value)</code>: If the value is NA, replace with 0, otherwise keep the original value</li>
</ul></li>
</ul>
<p>This is much more efficient than writing separate <code>mutate()</code> statements for each column, and it’s robust – if you add more numeric columns later, they’ll automatically be included in the transformation.</p>
</section>
<section id="step-6-the-full-solution-explained" class="level2">
<h2 class="anchored" data-anchor-id="step-6-the-full-solution-explained">Step 6: The Full Solution Explained</h2>
<p>Now let’s put it all together with detailed explanations and a little bit of flair:</p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our final, polished table</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>final_table <span class="ot">&lt;-</span> wvs_nona <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Create counts for each combination</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gender, country, relationship_status) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2: Filter to our relationship statuses of interest</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relationship_status <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"married"</span>, <span class="st">"separated"</span>, <span class="st">"divorced"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Reshape from long to wide format</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> country,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> <span class="fu">c</span>(gender, relationship_status),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 4: Handle NAs properly for count data</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 5: Add row totals</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="sc">-</span>country))) <span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 6: Create the GT table</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 7: Add headers</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"World Value Survey (WVS)"</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Data extract from r4np"</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 8: Create nested column spanners</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"*female*"</span>),</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"female_"</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"*male*"</span>),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"male_"</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">md</span>(<span class="st">"**Gender**"</span>),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"female_"</span>, <span class="st">"male_"</span>)),</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"gender"</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 9: Customise column labels</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">country =</span> <span class="fu">md</span>(<span class="st">"**Country**"</span>),</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">md</span>(<span class="st">"**Total**"</span>),</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">"married"</span>) <span class="sc">~</span> <span class="st">"married"</span>,</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">"separated"</span>) <span class="sc">~</span> <span class="st">"separated"</span>,</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">"divorced"</span>) <span class="sc">~</span> <span class="st">"divorced"</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 10: Add visual elements</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_plt_bar</span>(<span class="at">column =</span> total) <span class="sc">%&gt;%</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 11: Add footer information</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_footnote</span>(<span class="fu">md</span>(<span class="st">"**Source:**&lt;br&gt;*World Value Survey (2024)*"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 12: Apply a theme</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_espn</span>()</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>final_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Admittedly, this code chunk is a lot more substantial than going with the standard <code>gt</code> table setup, but it certainly looks a lot more audience-ready and accessible</p>
<p>Let me explain the final formatting steps so you can apply those changes to your own tables as well:</p>
<p><strong>Visual Enhancement with <code>gt_plt_bar()</code></strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_plt_bar</span>(<span class="at">column =</span> total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function from the <code>gtExtras</code> package adds mini bar charts to the total column. It automatically scales the bars based on the values in the column, making it easy to visually compare totals across countries. The bars appear within the table cells themselves.</p>
<p><strong>Footnotes for Attribution</strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_footnote</span>(<span class="fu">md</span>(<span class="st">"**Source: **&lt;br&gt;*World Value Survey (2024)*"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>tab_footnote()</code> adds a footnote to the table. The <code>&lt;br&gt;</code> is HTML for a line break, and again we’re using <code>md()</code> to enable markdown formatting for bold text and italics.</p>
<p><strong>Theming with <code>gt_theme_espn()</code></strong></p>
<div class="cell slide-in">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This applies a pre-built theme that mimics the ESPN sports network styling. The <code>gtExtras</code> package includes several pre-built themes that can dramatically change your table’s appearance with a single line of code. This is particularly helpful if you want to quickly apply a uniform style to all your tables in a presentation, report or publication.</p>
</section>
<section id="why-this-approach-works" class="level2">
<h2 class="anchored" data-anchor-id="why-this-approach-works">Why This Approach Works</h2>
<p>The manual approach we’ve taken here solves several problems:</p>
<ol type="1">
<li><strong>Flexibility</strong>: We can style each spanner and column label exactly how we want.</li>
<li><strong>Maintainability</strong>: The pattern-based selection (<code>starts_with()</code>, <code>ends_with()</code>) means our code will work even if column names change slightly.</li>
<li><strong>Scalability</strong>: If we add more countries or relationship statuses, most of the code will still work.</li>
<li><strong>Readability</strong>: Each step has a clear purpose and the code is self-documenting.</li>
</ol>
</section>
<section id="the-lessons-learned" class="level2">
<h2 class="anchored" data-anchor-id="the-lessons-learned">The Lessons Learned</h2>
<p>Creating multi-dimensional tables in <code>gt</code> teaches us several important concepts:</p>
<ol type="1">
<li><p><strong>Data shape matters</strong>: The structure of your data determines how easy it is to create your desired table. Sometimes reshaping is necessary.</p></li>
<li><p><strong>NA handling is context-dependent</strong>: In count data, NA often means zero, but in other contexts, it might mean something else entirely. Therefore, we might have to amend our table values as necessary.</p></li>
<li><p><strong>Pattern-based selection is powerful</strong>: Functions like <code>starts_with()</code>, <code>ends_with()</code>, and <code>where()</code> make your code more robust, concise and less prone to errors.</p></li>
<li><p><strong>The <code>~</code> formula syntax</strong>: This R feature appears in many places (<code>cols_label()</code>, <code>across()</code>, <code>ggplot2</code>) and is worth understanding deeply.</p></li>
<li><p><strong>Layered approach</strong>: <code>gt</code>’s philosophy of building tables layer by layer makes complex tables a lot more manageable.</p></li>
</ol>
<p>The GT package is incredibly powerful, but like any sophisticated tool, it rewards understanding its patterns and conventions. When your table needs go beyond the basics, don’t be afraid to break down the problem into smaller steps and build up your solution incrementally.</p>
</section>
<section id="want-to-learn-more" class="level2">
<h2 class="anchored" data-anchor-id="want-to-learn-more">Want to Learn More?</h2>
<ul>
<li><a href="https://gt.rstudio.com/">GT Package Documentation</a> - Comprehensive guide with examples</li>
<li><a href="https://jthomasmock.github.io/gtExtras/">GT Extras Package</a> - Additional functionality and themes</li>
<li><a href="https://r4np.com">R for Non-Programmers</a> - If you want to strengthen your R fundamentals</li>
</ul>
<p>The key to mastering <code>gt</code> (and R in general) is understanding the building blocks and how they combine. Once you grasp these patterns, you’ll find yourself creating publication-ready tables with confidence and in no time.</p>
<p>Happy table-making!</p>


</section>

</main> <!-- /main -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  console.log('Animation script loaded!');

  const slideIns = document.querySelectorAll(".slide-in, .slide-in-left, .slide-in-right, .fade-in, .scale-in");
  console.log('Found elements to animate:', slideIns.length);

  // Check if user prefers reduced motion
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (prefersReducedMotion) {
    slideIns.forEach(el => el.classList.add('visible'));
    return;
  }

  const observer = new IntersectionObserver(
    entries => {
      entries.forEach(entry => {
        console.log('Element intersecting:', entry.isIntersecting);
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
          console.log('Added visible class to element');
        }
      });
    },
    {
      threshold: 0.1,
      rootMargin: '0px 0px -100px 0px'
    }
  );

  slideIns.forEach(el => observer.observe(el));
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>